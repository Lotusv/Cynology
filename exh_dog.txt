<UserControl x:Class="KinoUI.Content.ExhibitionDogRegistrationUC"
            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:telerikControls="clr-namespace:Telerik.Windows.Controls;assembly=Telerik.Windows.Controls"
              xmlns:telerik="http://schemas.telerik.com/2008/xaml/presentation" 
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:data="clr-namespace:KinoDataLibrary;assembly=KinoDataLibrary"
              xmlns:my="clr-namespace:KinoUI"
             xmlns:content="clr-namespace:KinoUI.Content"
             xmlns:mui="http://firstfloorsoftware.com/ModernUI"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" x:Name="dogExhibitionsUC"
             d:DesignHeight="305" d:DesignWidth="767"  Loaded="dogExhibitionsUC_Loaded">
    <UserControl.Resources>
        <data:KinoDataSet x:Key="kinoDataSet" />

        <CollectionViewSource x:Key="exhibitionDogViewSource" Source="{Binding DataContext.tbl_pedigree_exhibition, RelativeSource={RelativeSource AncestorType={x:Type content:ExhibitionDogRegistrationUC}}}" />
        <CollectionViewSource x:Key="pedigreeViewSource" Source="{Binding DataContext.tbl_pedigree, RelativeSource={RelativeSource AncestorType={x:Type content:ExhibitionDogRegistrationUC}}}" />
        <CollectionViewSource x:Key="View_DogsWithExtendedDescriptionViewSource" Source="{Binding DataContext.View_DogsListForExhibitions, RelativeSource={RelativeSource AncestorType={x:Type content:ExhibitionDogRegistrationUC}}}" />
        <CollectionViewSource x:Key="agegroupViewSource" Source="{Binding DataContext.tbl_agegroup, RelativeSource={RelativeSource AncestorType={x:Type content:ExhibitionDogRegistrationUC}}}" />
        <CollectionViewSource x:Key="Func_DogExhibitionStatusEnumsViewSource" Source="{Binding DataContext.Func_DogExhibitionStatusEnums, RelativeSource={RelativeSource AncestorType={x:Type content:ExhibitionDogRegistrationUC}}}" />

        
        <CollectionViewSource x:Key="personViewSource" Source="{Binding DataContext.tbl_person, RelativeSource={RelativeSource AncestorType={x:Type content:ExhibitionDogRegistrationUC}}}" />
        <CollectionViewSource x:Key="ExhibitionStatusViewSource" Source="{Binding DataContext.Func_ExhibitionStatusEnums, RelativeSource={RelativeSource AncestorType={x:Type content:ExhibitionDogRegistrationUC}}}" />


        <my:AgeCategoriesByDogSourceConverter x:Key="ageCategoriesByDogSourceConverter"/>
        <my:OwnersByDogConverter x:Key="ownersByDogConverter"/>
        <Style TargetType="telerik:RadComboBoxItem">
            <Setter Property="Background" Value="Beige"/>
        </Style>
    </UserControl.Resources>

    <UserControl.DataContext>
        <StaticResourceExtension ResourceKey="kinoDataSet"/>
    </UserControl.DataContext>

    <Grid >

        <Grid.RowDefinitions>
            <RowDefinition Height="30"></RowDefinition>
            <RowDefinition Height="*"></RowDefinition>
        </Grid.RowDefinitions>
        <StackPanel Orientation="Horizontal">
            <telerik:RadMenu>

                <telerik:RadMenuItem Header="Save" x:Name="mnuSave" Click="mnuSave_Click"></telerik:RadMenuItem>

            </telerik:RadMenu>
        </StackPanel>
        <Grid  Grid.Row="1" DataContext="{StaticResource exhibitionDogViewSource}">
            <telerik:RadGridView x:Name="grdDogExhibitions"  AutoGenerateColumns="False"  CellValidating="grdDogExhibitions_CellValidating"
                                 NewRowPosition="Top" ValidatesOnDataErrors="InEditMode"
                                 ItemsSource="{Binding }" 
                                 RowValidating="gridview_RowValidating"
                                 telerikControls:StyleManager.Theme="Transparent" Margin="0,0,0,0" 
                                 RowStyleSelector="{StaticResource modifiedRowStyle}" BeginningEdit="grdDogExhibitions_BeginningEdit" CellEditEnded="grdDogExhibitions_CellEditEnded" >


                <telerik:RadGridView.Columns>


                    <telerik:GridViewDataColumn Header="Reg Number" DataMemberBinding="{Binding registrationNumber}" IsReadOnly="True" Width="80"  />

                    <telerik:GridViewDataColumn Header="Date" DataMemberBinding="{Binding registration_date}" DataFormatString="{} {0:dd.MMM.yyyy}" Width="80">
                        <telerik:GridViewDataColumn.CellEditTemplate>
                            <DataTemplate>
                                <telerik:RadDatePicker SelectedValue="{Binding registration_date, Mode=TwoWay}"
                                                       SelectedDate="{x:Static sys:DateTime.Now}"
                                                       InputMode="DatePicker" />
                            </DataTemplate>
                        </telerik:GridViewDataColumn.CellEditTemplate>
                    </telerik:GridViewDataColumn>

                    <telerik:GridViewComboBoxColumn Header="Dog" Width="160"
                                                    DataMemberBinding="{Binding Mode=TwoWay, Path=pedigree_id, TargetNullValue=0}" 
                                                    SelectedValueMemberPath="pedigree_id" 
                                                    DisplayMemberPath="full_name"
                                                    ItemsSource="{Binding Source={StaticResource pedigreeViewSource}}">
                        <telerik:GridViewComboBoxColumn.CellEditTemplate>
                            <DataTemplate>
                                <telerik:RadComboBox IsEditable="True" TextSearchMode="Contains" IsFilteringEnabled="True"
                                                 SelectedValue="{Binding pedigree_id,Mode=TwoWay,TargetNullValue=0}" 
                                                 DisplayMemberPath="Descr" 
                                                 SelectedValuePath="pedigree_id" 
                                                 ItemsSource="{Binding Source={StaticResource View_DogsWithExtendedDescriptionViewSource}}" />
                            </DataTemplate>
                        </telerik:GridViewComboBoxColumn.CellEditTemplate>
                    </telerik:GridViewComboBoxColumn>

                    <telerik:GridViewDataColumn Header="Ring order number" DataMemberBinding="{Binding ring_ordernumber}" Width="80" />


                    <telerik:GridViewComboBoxColumn Header="Agegroup"   ItemsSource="{Binding  Source={StaticResource agegroupViewSource}}"
                                                    DataMemberBinding="{Binding Mode=TwoWay, Path=agegroup_id}" Width="80"
                                                    SelectedValueMemberPath="agegroup_id" EditTriggers="CellClick"
                                                    DisplayMemberPath="agegroup">
                        <telerik:GridViewComboBoxColumn.EditorStyle>
                            <Style TargetType="telerik:RadComboBox">
                                <Setter Property="IsFilteringEnabled" Value="True"/>
                                <Setter Property="StaysOpenOnEdit" Value="True"/>
                                <Setter Property="ItemsPanel">
                                    <Setter.Value>
                                        <ItemsPanelTemplate>
                                            <StackPanel/>
                                        </ItemsPanelTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </telerik:GridViewComboBoxColumn.EditorStyle>

                        <telerik:GridViewComboBoxColumn.CellEditTemplate>
                            <DataTemplate>
                                <telerik:RadComboBox x:Name="AgeComboEditor" IsEditable="True" TextSearchMode="Contains" IsFilteringEnabled="True"
                                                 SelectedValue="{Binding agegroup_id,Mode=TwoWay}" Width="80"
                                                 DisplayMemberPath="agegroup" 
                                                 SelectedValuePath="agegroup_id" 
                                                 ItemsSource="{Binding Converter={StaticResource ageCategoriesByDogSourceConverter}}" />
                            </DataTemplate>
                        </telerik:GridViewComboBoxColumn.CellEditTemplate>

                    </telerik:GridViewComboBoxColumn>


                    <telerik:GridViewComboBoxColumn Header="Owner"   ItemsSource="{Binding  Source={StaticResource personViewSource}}"
                                                    DataMemberBinding="{Binding Mode=TwoWay, Path=person_id}" 
                                                    SelectedValueMemberPath="person_id" EditTriggers="CellClick"
                                                    DisplayMemberPath="FullName" Width="100">
                        <telerik:GridViewComboBoxColumn.EditorStyle>
                            <Style TargetType="telerik:RadComboBox">
                                <Setter Property="IsFilteringEnabled" Value="True"/>
                                <Setter Property="StaysOpenOnEdit" Value="True"/>
                                <Setter Property="ItemsPanel">
                                    <Setter.Value>
                                        <ItemsPanelTemplate>
                                            <StackPanel/>
                                        </ItemsPanelTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </telerik:GridViewComboBoxColumn.EditorStyle>

                        <telerik:GridViewComboBoxColumn.CellEditTemplate>
                            <DataTemplate>
                                <telerik:RadComboBox x:Name="OwnerComboEditor" IsEditable="True" TextSearchMode="Contains" IsFilteringEnabled="True"
                                                 SelectedValue="{Binding person_id,Mode=TwoWay}" 
                                                 DisplayMemberPath="FullName" 
                                                 SelectedValuePath="person_id" 
                                                 ItemsSource="{Binding Converter={StaticResource ownersByDogConverter}}" />
                            </DataTemplate>
                        </telerik:GridViewComboBoxColumn.CellEditTemplate>

                    </telerik:GridViewComboBoxColumn>

                    <telerik:GridViewComboBoxColumn Header="Status"   ItemsSource="{Binding Source={StaticResource Func_DogExhibitionStatusEnumsViewSource}}" 
                                                    DataMemberBinding="{Binding Mode=TwoWay, Path=registration_status}" Width="80"
                                                    SelectedValueMemberPath="DogExhibitionStatusEnum" 
                                                    DisplayMemberPath="DogExhibitionStatus"  />


                </telerik:RadGridView.Columns>
            </telerik:RadGridView>
        </Grid>

    </Grid>
</UserControl>